---
title: "Statistics of Simulated Algal Floway Productivity"
author: "Dean Calahan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Floway Uniformity and Heterogeneity

We assume that biomass productivities from each of two identical floways operated
identically are identical. However we know from simple observation that
uniformity is absent both laterally and longitudinally in any pair of floways, in
terms of both distribution of species and density of biomass. Differences in
harvesting mechanics also reduce uniformity between floway dynamics.

The problem in comparing the results of experimental factors to controls thus becomes
determining how to reject H0. Here we use simulated time series data assuming a sinusoidal
annual mean productivity with normally distributed variance to compare "identical"
and "different" results from two floways in order to determine diagnostic measures
that can be used in deciding whether to reject H0.

## Simulated Productivity Data
We model floway produtivity by assuming continuous floway operation (i.e. no 
downtime for winter), with a sinusoidal biomass productivity response to seasonal 
periodicity, with dates of maximum and minimum productivity separated by six months,
and weekly harvesting. We then modify the curve by adding randomly chosen normally
distributed values (deltas) with a mean of 0 and a defined variance. Two approaches
are taken: 1) the random values represent gross variances that are simply added
to the sine curve; 2) the random values represent percentages of the simulated "true"
value, such that variances of lower simluated productivities are lower in absolute
value than the variances in larger simluated productivities.

```{r settings, echo=FALSE}
setwd("/Users/dean/Documents/Projects/ATS/Floways/Forshungszentrum JÃ¼lich/Experiment Campaign")
source("Code/R/Settings.R")
#source("Code/R/CEfaAFRaDPaFZJ.R")
```

## Ideal Weekly Productivity Time Series  
The ideal weekly productivity curve is a sinusoidal curve with a period of 52 weeks,
whose amplitude is the difference between the maximum and minimum productivity,
whose minimum is translated along the y axis direction to correspond with minimum
productivity, and whose peak is translated along the x axis to correspond to the
center of the period.
```{r idealcurve, fig.width=3, fig.height=4}
# One presumes there is a more elegant way of doing this.
IdealCurve <- function(maxprod, minprod) {
    dayx <- sin(2*pi*((-length(yearweeks)/4)+(0:(yearweeks-1))/yearweeks))
    dayx <- 0.5 + dayx / 2
    dayx <- (maxprod - minprod) * dayx
    dayx <- dayx + minprod
    return(dayx)
}

idealvals <- IdealCurve(20, 5)
par(mfrow=c(2,1), mai=c(0.3, 0.6, 0.3, 0.1))
plot(1:52, idealvals, type="l", ylab = "Productivity")
title("Ideal Curve")
```
  
Figure 1. Idealized floway productivity curve for a complete growing season. Curve
begins at the lowest productivity, peaks 26 weeks later, then returns to a minimum.

## Randomized Weekly Productivity Time Series  
To modify the ideal curve by gross values, we take 52 random samples from a normal
distribution with a defined range and standard deviation and add those values to
the ideal curve.
```{r figure1}
# t <- sample(1:1000, 1) # run this to get a random seed
set.seed(974)
RandomizedCurve <- function(vals, range, vvar, pct=FALSE) {
    deltas <- rnorm(yearweeks, range, vvar)
    if(pct) {
        deltas <- deltas * vals/max(vals)
    }
    return(deltas + vals)
}

randvals1 <- RandomizedCurve(idealvals, 2, 2)
randvals2 <- RandomizedCurve(idealvals, 2, 2)
```
```{r figure2, fig.width=6, fig.height=3, echo=FALSE}
par(mfrow=c(1,2), mai=c(0.4, 0.6, 0.4, 0.1))
plot(1:52, randvals1, type="l")
title("Randomized Curve 1")
plot(1:52, randvals2, type="l")
title("Randomized Curve 2")
```

Figure 2. Two different randomized floway productivity curves using gross variations.
The idealized productivity curve (Fig. 1) has been modified by adding values sampled
from a normal distribution with a range and standard deviation of 2.  

To modify the ideal curve by percentages we multiply the gross delta by the proportion
of the idealized value for that week to the maximum idealized value. Thus, what
would be a delta of 1 for the maximum value (25) of an idealized curve ranging from
5 to 25 would be 0.2 for the minimum value of 5.
```{r figure3, fig.width=6, fig.height=3, echo=FALSE}
randvals3 <- RandomizedCurve(idealvals, 2, 2, TRUE)
randvals4 <- RandomizedCurve(idealvals, 2, 2, TRUE)

par(mfrow=c(1,2), mai=c(0.4, 0.6, 0.4, 0.1))
plot(1:52, randvals3, type="l")
title("Randomized Curve 1")
plot(1:52, randvals4, type="l")
title("Randomized Curve 2")
```

Figure 3. Two different randomized productivity curves using proportional variations.
The idealized productivity curve (Fig. 1) has been modified by adding values sampled
from a normal distribution with a range and standard deviation of 2, multiplied
by the ratio of the idealized value for the week to the maximum idealized value.  

## The statistics of equality.
